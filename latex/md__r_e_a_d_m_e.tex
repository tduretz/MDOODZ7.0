Welcome to MDOODZ7.\+0 public repository! This version of MDOODZ is under construction, more testing will be progressively added...

\hypertarget{md__r_e_a_d_m_e_autotoc_md1}{}\doxysection{@ref /\+VISUAL\+\_\+\+TESTS/readme.\+md \char`\"{}\+Visual Test Results\char`\"{}}\label{md__r_e_a_d_m_e_autotoc_md1}
\hypertarget{md__r_e_a_d_m_e_autotoc_md2}{}\doxysection{Library usage}\label{md__r_e_a_d_m_e_autotoc_md2}
MDOODZ Source Code stored in {\ttfamily MDLIB} directory and compiled as a separate library {\ttfamily libmdoodz} with the public interface {\ttfamily mdoodz.\+h}.

The public interface includes a struct that stores input parameters and setup toolchains\+: {\ttfamily Mdoodz\+Input}. To run the simulation {\ttfamily Mdoodz\+Input} must be passed to {\ttfamily Run\+MDOODZ(\+Mdoodz\+Input $\ast$input)} function\hypertarget{md__r_e_a_d_m_e_autotoc_md3}{}\doxysubsubsection{Examples\+:}\label{md__r_e_a_d_m_e_autotoc_md3}
1) Simple or Pure Shear\+: \href{SETS/ShearTemplate.c}{\texttt{ Shear\+Template}} 2) A free surface model\+: \href{SETS/TopoBenchCase1.c}{\texttt{ Topo\+Bench\+Case1}} 3) A free surface and thermal solution model\+: \href{SETS/RiftingChenin.c}{\texttt{ Rifting\+Pauline}} 4) Grain size evolution model\+: \href{SETS/PinchSwellGSE.c}{\texttt{ Pinch\+Swell\+GSE}} 5) Quartz-\/\+Coesite inclusion density change in Garnet\+: \href{SETS/QuartzCoesite.c}{\texttt{ Quartz\+Coesite}}\hypertarget{md__r_e_a_d_m_e_autotoc_md4}{}\doxysubsection{Input parameters}\label{md__r_e_a_d_m_e_autotoc_md4}

\begin{DoxyItemize}
\item {\ttfamily input\+File\+Name} stores the name of the {\ttfamily .txt} file with input parameter key = value pairs
\item {\ttfamily model} aggregates general input parameters from {\ttfamily .txt} file
\item {\ttfamily materials} aggregates input parameters from {\ttfamily .txt} file concerning phase properties
\item {\ttfamily scale} aggregates input parameters from {\ttfamily .txt} file concerning scaling of units
\item {\ttfamily crazy\+Conductivity} contains parameters for the crazy conductivity of the asthenosphere for the initialisation step
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md5}{}\doxysubsubsection{Import files}\label{md__r_e_a_d_m_e_autotoc_md5}
Import files are the external files that are processed by MDOODZ and contains information such as phase transition diagrams or particle geometry. Described by {\ttfamily import\+\_\+files\+\_\+dir} and {\ttfamily import\+\_\+file}\hypertarget{md__r_e_a_d_m_e_autotoc_md6}{}\doxysubsubsection{Crazy conductivity}\label{md__r_e_a_d_m_e_autotoc_md6}
If you wish to add crazy conductivity of the asthenosphere to the initialisation step there is a {\ttfamily crazy\+Conductivity} parameter that points to the struct that aggregates
\begin{DoxyItemize}
\item {\ttfamily phases} array of phases ids that crazy conductivity should be applied to
\item {\ttfamily n\+Phases} total number of phases
\item {\ttfamily multiplier} refers to the multiplier of the effective conductivity
\end{DoxyItemize}

If your {\ttfamily .txt} file shares the same name as executable, you could extract it with the {\ttfamily Get\+Setup\+File\+Name(nargs, args)} function on Unix systems\hypertarget{md__r_e_a_d_m_e_autotoc_md7}{}\doxysubsection{Setup toolchain}\label{md__r_e_a_d_m_e_autotoc_md7}
Structures that aggregate pointers to the functions that will be used in a runtime as callback functions. Some of those functions must be implemented, but others if not implemented will give a default result\hypertarget{md__r_e_a_d_m_e_autotoc_md8}{}\doxysubsubsection{Build\+Initial\+Topography}\label{md__r_e_a_d_m_e_autotoc_md8}
Aggregates pointers to functions for setting up topography chain properties. Must have if {\ttfamily model.\+free\+\_\+surf == 1}.


\begin{DoxyItemize}
\item {\ttfamily Set\+Surface\+ZCoord} describes an altitude in relation to the x coordinate. Default value is {\ttfamily 1.\+0e3 / input-\/\texorpdfstring{$>$}{>}scaling.\+L}\+: flat surface will be generated
\item {\ttfamily Set\+Surface\+Phase} describes a topography chain particle phase id in relation to the x coordinate. Default phase {\ttfamily 0}
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md9}{}\doxysubsubsection{Set\+Particles}\label{md__r_e_a_d_m_e_autotoc_md9}
Aggregates pointers to functions for setting up particle properties. Must have.


\begin{DoxyItemize}
\item {\ttfamily Set\+Horizontal\+Velocity} describes a particle Horizontal Velocity (Vx) in relation to coordinates. Default value is {\ttfamily -\/coordinates.\+x $\ast$ input-\/\texorpdfstring{$>$}{>}model.\+Eps\+BG}
\item {\ttfamily Set\+Vertical\+Velocity} describes a particle Vertical Velocity (Vz) in relation to coordinates. Default value is {\ttfamily coordinates.\+z $\ast$ input-\/\texorpdfstring{$>$}{>}model.\+Eps\+BG}
\item {\ttfamily Set\+Phase} describes a particle phase id in relation to coordinates. Default value is {\ttfamily 0}\+: model will be homogeneous
\item {\ttfamily Set\+Temperature} describes a particle temperature in relation to coordinates. Default value is {\ttfamily 273.\+15 / input-\/\texorpdfstring{$>$}{>}scaling.\+T}\+: model is 0Â°C
\item {\ttfamily Set\+Grain\+Size} describes a particle grain size in relation to coordinates. Default value is {\ttfamily 0.\+0}
\item {\ttfamily Set\+Porosity} describes a particle grain porosity in relation to coordinates. Default value is {\ttfamily 0.\+0}
\item {\ttfamily Set\+Density} describes a particle grain density in relation to coordinates. Default value is set according to the particle phase
\item {\ttfamily Set\+XComponent} describes a particle X component value in relation to coordinates. Default value is {\ttfamily 0.\+0}
\item {\ttfamily Set\+Pressure} describes a particle pressure value in relation to coordinates. Default value is {\ttfamily 0.\+0}
\item {\ttfamily Set\+Noise} describes a noise property value in relation to coordinates. Default value is {\ttfamily 0.\+0}
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md10}{}\doxysubsection{Set\+BCs}\label{md__r_e_a_d_m_e_autotoc_md10}
Aggregates pointers to functions for setting up Boundary Conditions in a mesh grid. Must have.


\begin{DoxyItemize}
\item {\ttfamily Set\+BCVx} describes the type and value of the Vx point. Must be implemented. Pre-\/made functions from mdoodz library can be used\+: {\ttfamily Set\+Pure\+Shear\+BCVx}, {\ttfamily Set\+Simple\+Shear\+BCVx}, {\ttfamily Set\+Pure\+Or\+Simple\+Shear\+BCVx} (depends on {\ttfamily shear\+\_\+style} input parameter)
\item {\ttfamily Set\+BCVz} describes the type and value of the Vz point. Must be implemented. Pre-\/made functions from mdoodz library can be used\+: {\ttfamily Set\+Pure\+Shear\+BCVz}, {\ttfamily Set\+Simple\+Shear\+BCVz}, {\ttfamily Set\+Pure\+Or\+Simple\+Shear\+BCVz} (depends on {\ttfamily shear\+\_\+style} input parameter)
\item {\ttfamily Set\+BCPType} describes the type of the Pressure Boundary conditions point. Default one is {\ttfamily -\/1}
\item {\ttfamily Set\+BCT} describes the Temperature Boundary type and value. Must be implemented if {\ttfamily model.\+isthermal == 1}
\item {\ttfamily Set\+BCTNew} describes the Temperature Boundary type and value on 1d boundary array. Must be implemented if {\ttfamily model.\+isthermal == 1}. Will be deprecated
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md11}{}\doxysection{CMake usage}\label{md__r_e_a_d_m_e_autotoc_md11}
Project is ready to be built in CMake\hypertarget{md__r_e_a_d_m_e_autotoc_md12}{}\doxysubsection{Prequisites and setup}\label{md__r_e_a_d_m_e_autotoc_md12}
In order to build MDOODZ with CMake you have to install {\ttfamily cmake 3.\+16} or newer version. {\ttfamily blas}, {\ttfamily zlib} and {\ttfamily lapack} libraries are CMake compatible and does not require any additional setup other than installing them with your package manager\+:

If you want to use your fixed environmental variables, set them up in a {\ttfamily env.\+cmake} file. Just copy {\ttfamily env.\+cmake.\+example} without {\ttfamily example} suffix.


\begin{DoxyCode}{0}
\DoxyCodeLine{sudo apt-\/get install libblas-\/dev liblapack-\/dev zlib1g-\/dev libhdf5-\/serial-\/dev}

\end{DoxyCode}


There are two ways how to use Suite\+Sparse\+:

1) Build Suite\+Sparse to the project\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{make install-\/suitesparse}

\end{DoxyCode}


2) Specify path to the build Suite\+Sparse on your machine in the {\ttfamily env.\+cmake} file\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{set(SuiteSparse\_DIR /usr/lib/x86\_64-\/linux-\/gnu/)}

\end{DoxyCode}


If there is a Suite\+Sparse in a {\ttfamily deps} folder, it will be automatically linked with the MDOODZ. Otherwise it will try to find library and headers in a specified path.\hypertarget{md__r_e_a_d_m_e_autotoc_md13}{}\doxysubsection{How to use}\label{md__r_e_a_d_m_e_autotoc_md13}
You can specify C Compiler in the {\ttfamily env.\+cmake} file. By default, it\textquotesingle{}s gcc\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{set(C\_COMPILER gcc)}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md14}{}\doxysubsubsection{Add your set to the CMake}\label{md__r_e_a_d_m_e_autotoc_md14}
1) In a {\ttfamily SETS} directory you need to create executable {\ttfamily Your\+Set\+Name.\+c} file and the {\ttfamily Your\+Set\+Name.\+txt} setup file. Both files should have a same name. 2) In {\ttfamily SETS/\+CMake\+Lists.\+txt} file add a line with the command {\ttfamily add\+\_\+set(\+Your\+Set\+Name)} and it will be built as executable by default. 3) Alternatively you could build your set with specifying it as a command line argument. Examples are given below\hypertarget{md__r_e_a_d_m_e_autotoc_md15}{}\doxysubsubsection{Build and run}\label{md__r_e_a_d_m_e_autotoc_md15}
CMake gives us a framework for building MDOODZ in developer mode or as a separate package and CTest can be used as test suite.

Makefile related to cmake is located in a root directory

To build library, tests and executables with Open\+MP and in optimised mode\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{make build SET=RiftingPauline}

\end{DoxyCode}


To explicitly set OPT (optimisation) and OMP (Open\+MP). If not stated, it\textquotesingle{}s OFF by default


\begin{DoxyCode}{0}
\DoxyCodeLine{make build-\/dev OMP=ON OPT=ON SET=RiftingPauline}

\end{DoxyCode}


Build files will be located at the {\ttfamily cmake-\/build/} directory. Executables will be stored in a {\ttfamily cmake-\/exec/\+Your\+Set\+Name/} directory

After building, you could run MDOODZ with\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{make run SET=YourSetName}

\end{DoxyCode}


or run autotests\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{make run-\/tests}

\end{DoxyCode}


Whole process in cluster mode with optimisation and Open\+MP\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{make clean build run SET=YourSetName}

\end{DoxyCode}


All output files generated by the runtime ({\ttfamily .gzip.\+h5}, {\ttfamily .dat}) will be stored in a same directory as the executable.

Setup {\ttfamily .txt} file will be automatically detected if it has a same name as the executable. But alternatively you can specify it explicitly\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{cd cmake-\/exec/YourSetName}
\DoxyCodeLine{./YourSetName /path/to/setup.txt}

\end{DoxyCode}
 