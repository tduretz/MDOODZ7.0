name: ci
on: [push]
jobs:
  ci:
    runs-on: ubuntu-latest
    env:
      HDF5_USE_FILE_LOCKING: FALSE
      C_INCLUDE_PATH: /usr/local/include:/usr/include/hdf5/serial:/usr/include/suitesparse
      LIBRARY_PATH: /usr/lib/:/usr/local/lib:/usr/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu/hdf5/serial
      OMP_NUM_THREADS: 8
    steps:
      - uses: actions/checkout@v2
      - name: update Ubuntu
        run: sudo apt update
      - uses: egor-tensin/setup-gcc@v1
      - name: install gcc@7
        run: sudo apt -y install gcc-7
      - name: install cmake and ninja
        run: sudo apt -y install cmake && sudo apt -y install ninja-build && dpkg -L ninja-build
      - name: install suite-sparse
        run: sudo apt -y install libatlas-base-dev
          && git clone https://github.com/jlblancoc/suitesparse-metis-for-windows/
          && cd suitesparse-metis-for-windows && cmake BUILD_METIS=0 -S . -B _build
          && cd _build && sudo make install
      - name: install hdf5
        run: sudo apt -y install libhdf5-serial-dev
      - name: prepare makefiile
        run: mv SOURCE/Makefiles/makefile_ubuntu_ci SOURCE/makefile
      - name: Builds cmake project
        run: cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_MAKE_PROGRAM=ninja -DMODEL=ShearTemplate -G Ninja -B./cmake-build -CMAKE_C_COMPILER=/usr/bin/gcc-7
          && cmake --build ./cmake-build  --target MDOODZ
      - name: Runs cmake project
        run: cd cmake-build && ./MDOODZ input.txt