#include "mdoodz.h"

int SetPhase(MdoodzInput *input, Coordinates coordinates) {

  int ncircles = 92;

  // (for 43 setup)
  //double Xshift[45] = { 0.046978 , -0.040324 , -0.053435 , -0.061423 , -0.14211 , -0.38538 , 0.35295 , -0.29507 , 0.077638 , 0.13441 , -0.43727 , -0.47698 , -0.31615 , 0.44211 , -0.30394 , -0.0040494 , 0.44791 , -0.26532 , -0.10146 , 0.23469 , -0.3409 , -0.48814 , -0.33281 , -0.025286 , 0.10512 , 0.2251 , -0.42016 , -0.14093 , 0.2918 , 0.36572 , 0.23162 , -0.33927 , 0.14209 , 0.42851 , 0.36281 , -0.14852 , -0.15766 , 0.33071 , -0.057203 , 0.27578 , -0.46081 , 0.43793 , 0.45258 , 0.056071 , 0.51186 };
  //double Zshift[45] = { -0.089576 , 0.13433 , -0.18984 , 0.073911 , 0.29223 , 0.28663 , -0.28515 , 0.29695 , -0.0038393 , 0.22996 , 0.15446 , -0.21768 , 0.17248 , 0.040619 , 0.12239 , 0.21691 , -0.28576 , -0.15873 , -0.13124 , 0.29589 , 0.22283 , 0.25705 , 0.04927 , -0.24263 , 0.095777 , 0.1043 , 0.24118 , -0.046123 , 0.0086339 , 0.064063 , -0.10075 , -0.22776 , -0.17712 , -0.19779 , 0.29015 , 0.17502 , -0.21603 , -0.21782 , -0.0078001 , 0.23424 , -0.013034 , 0.23173 , -0.043012 , -0.25632 , 0.25705 };
  //double Radius[45] = { 0.015168 , 0.015545 , 0.016023 , 0.016029 , 0.016342 , 0.016653 , 0.016759 , 0.016878 , 0.018033 , 0.01915 , 0.01939 , 0.019732 , 0.019968 , 0.02007 , 0.020588 , 0.021798 , 0.022207 , 0.022585 , 0.02493 , 0.026056 , 0.026139 , 0.027658 , 0.028615 , 0.028814 , 0.030043 , 0.030165 , 0.030192 , 0.030205 , 0.030607 , 0.032042 , 0.032721 , 0.033372 , 0.035025 , 0.035963 , 0.036024 , 0.036189 , 0.036702 , 0.036715 , 0.037428 , 0.037439 , 0.038008 , 0.03838 , 0.03845 , 0.039333 , 0.027658 };

  // (for 92 setup)
  double Xshift[92] = { -0.31786 , 0.11728 , -0.28784 , 0.035664 , -0.41292 , -0.10924 , 0.14206 , 0.26683 , -0.31926 , -0.33649 , 0.034138 , 0.48435 , 0.399 , 0.12735 , -0.15355 , 0.30445 , -0.10112 , 0.030629 , 0.30209 , 0.23423 , -0.25583 , 0.15245 , -0.048361 , 0.21957 , -0.056036 , -0.089371 , -0.045305 , 0.42368 , -0.47946 , 0.26733 , 0.2027 , 0.22578 , -0.27623 , 0.2261 , -0.41741 , -0.4125 , -0.47835 , -0.19109 , 0.31454 , -0.086573 , -0.37435 , 0.47126 , -0.070644 , 0.027847 , 0.38654 , 0.25052 , 0.24369 , 0.30056 , -0.25137 , 0.44558 , 0.16238 , 0.12594 , 0.18384 , 0.051793 , 0.45346 , -0.27133 , 0.083571 , 0.18554 , 0.25933 , 0.49616 , 0.18018 , 0.28907 , -0.48182 , -0.1633 , -0.22493 , 0.01182 , -0.32314 , -0.11613 , -0.39408 , -0.3159 , 0.025045 , -0.047407 , 0.4883 , -0.18257 , 0.4394 , -0.28227 , -0.11669 , 0.083533 , 0.28374 , -0.14547 , 0.0056366 , -0.18248 , 0.11644 , -0.20449 , -0.35781 , 0.43966 , -0.51565 , 0.52054 , 0.52165 , -0.50384 , 0.51818 , -0.5117 };
  double Zshift[92] = { -0.23071 , 0.22347 , -0.43494 , -0.51518 , 0.50729 , -0.058391 , -0.54293 , 0.52729 , 0.30781 , 0.40536 , -0.03525 , -0.4398 , -0.27709 , 0.51605 , -0.15296 , 0.2661 , 0.14337 , 0.32031 , 0.36045 , 0.37338 , 0.36098 , -0.060668 , -0.36543 , -0.15322 , 0.10585 , 0.20221 , 0.44706 , 0.23369 , -0.0091859 , 0.14949 , -0.45027 , 0.21013 , -0.11581 , -0.51354 , 0.025444 , -0.27787 , -0.12118 , 0.18462 , 0.42742 , 0.5202 , -0.35187 , 0.4189 , 0.32699 , 0.46082 , 0.11182 , 0.27406 , 0.59707 , -0.18915 , -0.54457 , -0.57413 , -0.25606 , 0.29882 , 0.40676 , -0.56897 , 0.17577 , -0.32354 , -0.064163 , -0.38745 , 0.0015395 , 0.52456 , 0.11703 , -0.26219 , 0.25881 , 0.57708 , -0.23561 , 0.17556 , -0.49935 , -0.48687 , 0.37392 , 0.10373 , 0.57495 , -0.012283 , -0.23902 , 0.25805 , 0.58173 , 0.20216 , 0.053887 , 0.09211 , -0.080087 , 0.39544 , -0.43468 , -0.34783 , -0.16505 , 0.47533 , 0.56755 , 0.34574 , -0.4398 , -0.0091859 , -0.12118 , 0.52456 , 0.25881 , -0.23902 };
  double Radius[92] = { 0.015114 , 0.015391 , 0.015465 , 0.016399 , 0.016409 , 0.016616 , 0.016776 , 0.017074 , 0.017106 , 0.017384 , 0.017442 , 0.017519 , 0.0177 , 0.017733 , 0.017815 , 0.018055 , 0.018358 , 0.018722 , 0.018813 , 0.018912 , 0.019276 , 0.020052 , 0.02045 , 0.020982 , 0.021465 , 0.021786 , 0.022505 , 0.022543 , 0.023105 , 0.023267 , 0.023568 , 0.023672 , 0.024001 , 0.024011 , 0.02418 , 0.02466 , 0.024748 , 0.024754 , 0.024863 , 0.025035 , 0.025091 , 0.025169 , 0.025183 , 0.026016 , 0.026096 , 0.026299 , 0.026411 , 0.026485 , 0.027505 , 0.027696 , 0.027924 , 0.027925 , 0.028003 , 0.028316 , 0.028664 , 0.028839 , 0.028847 , 0.028957 , 0.029368 , 0.029473 , 0.029762 , 0.030337 , 0.030435 , 0.03154 , 0.031726 , 0.032002 , 0.03237 , 0.032639 , 0.032845 , 0.033004 , 0.033059 , 0.034065 , 0.034072 , 0.035666 , 0.035806 , 0.035834 , 0.035855 , 0.035992 , 0.036597 , 0.036672 , 0.037156 , 0.037405 , 0.037921 , 0.038464 , 0.039151 , 0.039674 , 0.017519 , 0.023105 , 0.024748 , 0.029473 , 0.030435 , 0.034072 };
  
  // (for 5 setup -> for resolution testing)
  //double Xshift[5] = { -0.2 , -0.2 , 0.2 , 0.2 , 0 };
  //double Zshift[5] = { -0.2 , 0.2 , 0.2 , -0.2 , 0 };
  //double Radius[5] = { 0.1 , 0.1 , 0.1 , 0.1 , 0.1 };

  // scaling geometry values
  int i;
  for (i = 0; i < ncircles; ++i) {
    Radius[i] = Radius[i] / input->scaling.L;
    Xshift[i] = Xshift[i] / input->scaling.L;
    Zshift[i] = Zshift[i] / input->scaling.L;
  }

  bool isInsideSomeRadius = 0;
  bool isInsideThisRadius = 0;
  for (i = 0; i < ncircles; ++i) {
    isInsideThisRadius = (coordinates.x - Xshift[i]) * (coordinates.x - Xshift[i]) + (coordinates.z - Zshift[i]) * (coordinates.z - Zshift[i]) < Radius[i] * Radius[i];
    if (isInsideThisRadius > isInsideSomeRadius) {
      isInsideSomeRadius = isInsideThisRadius;
    }
  }

  if (isInsideSomeRadius) {
    return 1;
  } else {
    return 0;
  }
}

double SetDensity(MdoodzInput *input, Coordinates coordinates, int phase) {
  const double T_init = (zeroC) / input->scaling.T;
  if (1 == 0) {
    return input->materials.rho[phase] * (1 - input->materials.alp[phase] * (T_init - input->materials.T0[phase]));
  } else {
    return input->materials.rho[phase];
  }
}

int main() {
  MdoodzSetup setup = {
          .SetParticles  = &(SetParticles_ff){
                   .SetPhase              = SetPhase,
                   .SetDensity            = SetDensity,
          },
          .SetBCs = &(SetBCs_ff){
                  .SetBCVx = SetPureOrSimpleShearBCVx,
                  .SetBCVz = SetPureOrSimpleShearBCVz,
          },
  };
  RunMDOODZ("AnisoViscTest_evolv_multi_circles.txt", &setup);
}
